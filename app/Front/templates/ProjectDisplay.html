<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Analizador Sintáctico — Panel</title>
  <link rel="icon" href="{{ url_for('static', filename='icons/cube.ico') }}">
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='dashboard.css') }}" rel="stylesheet">
</head>

<body>
  <header class="navbar navbar-expand-lg px-3">
    <div class="container-fluid">
      <a class="navbar-brand brand" href="#">Analizador Sintáctico</a>
      <div class="d-flex align-items-center gap-3">
        <div class="small-muted">Usuario: <strong>Estudiante</strong></div>
      </div>
    </div>
  </header>

  <div class="d-flex">
    <!-- Sidebar -->
    <aside class="sidebar d-flex flex-column p-3" style="width:250px; background:#071029; min-height:100vh;">
      <h6>Panel de opciones</h6>
      <nav class="nav flex-column mt-3">
        <a class="nav-link active" data-view="welcome" href="#">Página principal</a>
        <a class="nav-link" data-view="manual" href="#">Manual de usuario</a>
        <a class="nav-link" data-view="analysis" href="#">Análisis</a>
      </nav>
    </aside>

    <!-- Main content -->
    <main id="main-content" class="flex-grow-1 p-4">
      <div id="dynamic-root"></div>
    </main>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const dynamicRoot = document.getElementById('dynamic-root');
    const navLinks = document.querySelectorAll('.nav-link');

    // ---------- Views ----------
    function showWelcome() {
      dynamicRoot.innerHTML = `
        <h2>Página principal</h2>
        <p>Bienvenido al Analizador Sintáctico Avanzado de Java. Aquí podrás analizar código, ver errores y generar reportes.</p>
      `;
      setActiveNav('welcome');
    }

    function showManual() {
      dynamicRoot.innerHTML = `
        <h2>Manual de usuario</h2>
        <iframe src="{{ url_for('static', filename='manual.pdf') }}" width="100%" height="600px" style="border:none;"></iframe>
      `;
      setActiveNav('manual');
    }

    function showAnalysis() {
      dynamicRoot.innerHTML = `
        <h2>Análisis de código Java</h2>
        <textarea id="code-input" class="form-control mb-3" rows="12" placeholder="// Pega tu código Java aquí"></textarea>
        <button id="btn-send" class="btn btn-primary mb-3">Analizar código</button>
        <div id="analysis-results"></div>
      `;
      setActiveNav('analysis');

      document.getElementById('btn-send').addEventListener('click', () => {
        const code = document.getElementById('code-input').value;
        if (!code.trim()) return alert('Debes ingresar código Java.');

        const results = document.getElementById('analysis-results');
        results.innerHTML = '<p>Procesando...</p>';

        fetch('/api/analyze', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ code })
        })
        .then(r => r.json())
        .then(json => {
          let html = '<h4>Tokens detectados:</h4>';
          if(json.tokens && json.tokens.length > 0) {
            html += '<ul>';
            json.tokens.forEach(t => html += `<li>${t.lexeme} — ${t.category} (Línea ${t.line})</li>`);
            html += '</ul>';
          } else {
            html += '<p>No se detectaron tokens.</p>';
          }

          html += `<h4>Errores:</h4><pre>${json.errors ? json.errors.join("\n") : 'No hay errores'}</pre>`;
          results.innerHTML = html;
        })
        .catch(err => {
          results.innerHTML = `<p style="color:red;">Error al procesar el código: ${err.message}</p>`;
        });
      });
    }

    // ---------- Navigation ----------
    function setActiveNav(view) {
      navLinks.forEach(a => {
        a.dataset.view === view ? a.classList.add('active') : a.classList.remove('active');
      });
    }

    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const view = link.dataset.view;
        if(view === 'welcome') showWelcome();
        if(view === 'manual') showManual();
        if(view === 'analysis') showAnalysis();
      });
    });

    // Cargar vista inicial
    showWelcome();
  </script>
</body>
</html>
